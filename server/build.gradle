description = 'CloudFoundry Identity Server JAR'

dependencies {

  compile project(':cloudfoundry-identity-model')

  compile group: 'org.apache.tomcat', name: 'tomcat-jdbc', version:parent.tomcatJdbcPoolVersion
  //Audit service dependency
  compile (group: 'com.ge.predix.audit', name: 'audit-sdk', version:'0.0.6') {
    exclude(module: 'httpclient')
  }
  compile group: 'org.glassfish', name: 'javax.el', version: '3.0.1-b08'

  compile group: 'com.fasterxml.jackson.core', name: 'jackson-databind', version: parent.jacksonVersion
  compile group: 'com.fasterxml.jackson.core', name: 'jackson-core', version: parent.jacksonVersion
  compile group: 'com.fasterxml.jackson.core', name: 'jackson-annotations', version: parent.jacksonVersion

  compile(group: 'com.ge.predix', name: 'spring-log-filter', version:'1.1.3') {
    exclude(group: 'ch.qos.logback')
  }

  provided group: 'javax.servlet', name: 'javax.servlet-api', version: parent.servletVersion
  compile group: 'javax.mail', name: 'mail', version: parent.javamailVersion

  compile group: 'commons-logging', name: 'commons-logging', version: parent.commonsLoggingVersion

  compile group: 'com.jayway.jsonpath', name: 'json-path', version: parent.jsonPathVersion
  compile group: 'com.google.zxing', name: 'javase', version: parent.zxingVersion

  compile group: 'org.springframework', name: 'spring-beans', version: parent.springVersion
  compile group: 'org.springframework', name: 'spring-context', version: parent.springVersion
  compile group: 'org.springframework', name: 'spring-tx', version: parent.springVersion
  compile group: 'org.springframework', name: 'spring-jdbc', version: parent.springVersion
  compile group: 'org.springframework', name: 'spring-web', version: parent.springVersion
  compile group: 'org.springframework', name: 'spring-context-support', version:springVersion
  compile group: 'org.springframework.security', name: 'spring-security-core', version: parent.springSecurityVersion
  compile group: 'org.springframework.security', name: 'spring-security-jwt', version: parent.springSecurityJwtVersion
  compile group: 'org.apache.httpcomponents', name: 'httpclient', version: parent.commonsHttpClientVersion
  compile group: 'org.springframework.security', name: 'spring-security-openid', version:springSecurityVersion
  compile group: 'org.springframework.security', name: 'spring-security-web', version:springSecurityVersion
  compile(group: 'org.springframework.security.extensions', name: 'spring-security-saml2-core', version:parent.springSecuritySamlVersion) {
    exclude(module: 'opensaml')
  }
  compile(group: 'org.opensaml', name: 'opensaml', version: openSamlVersion) {
    exclude(module: 'bcprov-jdk15on')
    exclude(group: 'org.slf4j', module: 'log4j-over-slf4j')
    exclude(group: 'org.owasp.esapi', module: 'esapi')
    exclude(group: 'ca.juliusdavies', module: 'not-yet-commons-ssl')
    exclude(group: "org.apache.velocity", module: 'velocity')
  }
  compile group: 'org.apache.santuario', name: 'xmlsec', version: parent.openSamlXmlSec
  compile group: 'org.apache.velocity', name: 'velocity-engine-core', version: '2.0'

  compile (group:'org.owasp.esapi', name:'esapi', version:parent.esapiVersion) {
    exclude(group: 'xalan', module: 'xalan')
    exclude(group: 'commons-beanutils', module: 'commons-beanutils-core')
    exclude(group: 'commons-fileupload', module: 'commons-fileupload')
    exclude(group: 'org.owasp.antisamy', module: 'antisamy')
  }
  compile group: 'commons-fileupload', name: 'commons-fileupload', version: parent.commonsFileuploadVersion
  compile group: 'commons-beanutils', name: 'commons-beanutils', version: parent.commonsBeanUtilsVersion
  compile group: 'org.owasp.antisamy', name: 'antisamy', version: parent.antisamyVersion
  compile group: 'xalan', name: 'xalan', version:parent.xalanVersion
  compile files('lib/not-yet-commons-ssl-0.3.17.jar')

  compile(group: 'org.springframework.security.oauth', name: 'spring-security-oauth2', version: parent.springSecurityOAuthVersion) {
    exclude(module: 'commons-codec')
    exclude(module: 'jackson-mapper-asl')
    exclude(module: 'spring-security-web')
  }

  compile group:'org.bouncycastle', name:'bcprov-jdk15on', version:parent.bcprovVersion
  compile group:'org.bouncycastle', name:'bcpkix-jdk15on', version:parent.bcpkixVersion

  compile group: 'com.google.guava', name:'guava', version:parent.guavaVersion

  compile group: 'org.aspectj', name: 'aspectjrt', version: parent.aspectJVersion

  compile group: 'org.thymeleaf', name: 'thymeleaf-spring4', version: parent.thymeleafVersion
  compile group: 'nz.net.ultraq.thymeleaf', name: 'thymeleaf-layout-dialect', version: parent.thymeleafDialectVersion
  compile group: 'org.thymeleaf.extras', name: 'thymeleaf-extras-springsecurity4', version: parent.thymeleafExtrasVersion

  compile(group: 'com.unboundid.product.scim', name: 'scim-sdk', version: parent.scimSDKVersion) {
    exclude(module: 'servlet-api')
    exclude(module: 'commons-logging')
    exclude(module: 'httpclient')
    exclude(module: 'wink-client-apache-httpclient')
  }

  compile group: 'org.hibernate', name: 'hibernate-validator', version: parent.hibernateValidatorVersion
  compile group: 'org.flywaydb', name: 'flyway-core', version: parent.flywayVersion
  compile group: 'org.hsqldb', name: 'hsqldb', version: parent.hsqldbVersion
  compile group: 'org.springframework.cloud', name: 'spring-cloud-spring-service-connector', version:'1.2.1.RELEASE'
  compile group: 'org.springframework.cloud', name: 'spring-cloud-cloudfoundry-connector', version:'1.2.1.RELEASE'

  compile group: 'org.yaml', name: 'snakeyaml', version: parent.snakeYamlVersion

  compile group: 'org.springframework.security', name: 'spring-security-ldap', version:parent.springSecurityVersion
  compile group: 'org.springframework.ldap', name: 'spring-ldap-core', version:parent.springSecurityLdapVersion
  compile group: 'org.springframework.ldap', name: 'spring-ldap-core-tiger', version:parent.springSecurityLdapVersion
  compile(group: 'org.apache.directory.api', name: 'api-ldap-model', version:parent.apacheLdapApiVersion) {
    exclude(module: 'slf4j-api')
  }

  compile group: 'org.passay', name: 'passay', version: parent.passayVersion

  compile group: 'com.warrenstrange', name:'googleauth', version: parent.googleauthVersion

  testCompile group: 'org.springframework', name: 'spring-test', version: parent.springVersion
  testCompile (group: 'junit', name: 'junit', version: parent.junitVersion) {
    exclude(module: 'hamcrest-core')
  }
  testCompile group: 'org.hamcrest', name: 'hamcrest-all', version: parent.hamcrestVersion
  testCompile (group: 'org.mockito', name: 'mockito-core', version: parent.mockitoVersion)  {
    exclude(module: 'hamcrest-core')
  }

  testCompile group: 'org.flywaydb', name: 'flyway-core', version: parent.flywayVersion
  testCompile group: 'org.postgresql', name: 'postgresql', version: parent.postgresqlVersion
  testCompile (group: 'com.microsoft.sqlserver', name: 'mssql-jdbc', version: parent.mssqlVersion){
    exclude(group: 'com.microsoft.azure', module: 'azure-keyvault')
  }
  testCompile group: 'org.powermock', name: 'powermock-module-junit4', version: parent.powermockVersion
  testCompile group: 'org.powermock', name: 'powermock-api-mockito2', version: parent.powermockVersion

  testCompile group: 'org.apache.tomcat', name: 'tomcat-jdbc', version:parent.tomcatJdbcPoolVersion

  testCompile group: 'com.jayway.jsonpath', name: 'json-path-assert', version: parent.jsonPathVersion

}

processResources {
  //maven replaces project.artifactId in the log4j.properties file
  //https://www.pivotaltracker.com/story/show/74344574
  filter { line -> line.contains('${project.artifactId}') ? line.replace('${project.artifactId}','cloudfoundry-identity-server') : line }
}

integrationTest {}.onlyIf { //disable since we don't have any
  true == false
}